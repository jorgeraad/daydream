# 20260212114211 - TUI Layout

| Field              | Value |
|--------------------|-------|
| **Created**        | 2026-02-12 11:42:20 EST |
| **Last Modified**  | 2026-02-12 13:10:38 EST |
| **Status**         | merged |
| **Branch**         | main |
| **Agent**          | bold-falcon |
| **Blocked-By**     | 20260212114210 |
| **Touches**        | packages/renderer/src/ui/ContextPanel.ts, packages/renderer/src/ui/MiniMap.ts, apps/game/src/GameShell.ts |
| **References**     | [Design Doc](../../docs/design.md), [PRD](../../docs/prd.md) |

## Description

Build the multi-panel TUI layout: game viewport (main area), side panel (mini-map placeholder + context info), and narrative bar (bottom scrollable text area). Handle responsive terminal resize. The context panel shows location name, time of day, and nearby NPCs. GameShell wires the layout as the top-level orchestrator.

## Acceptance Criteria

- [x] Multi-panel layout: viewport + side panel + narrative bar
- [x] Layout uses OpenTUI Flexbox and adapts to terminal resize
- [x] Side panel contains mini-map placeholder (FrameBuffer) and context panel
- [x] Context panel displays location name, time of day, nearby NPC names
- [x] Narrative bar is a ScrollBoxRenderable with scrollable text
- [x] Minimum 80x24 terminal size handled gracefully
- [x] GameShell orchestrates layout creation and system wiring
- [x] Player movement still works within the viewport panel
- [x] Unit tests for GameShell initialization and mode management
- [x] Visual smoke test: full game chrome renders with panels + walking player

## Implementation Steps

- [x] Review design doc layout specs and current renderer code
- [x] Create ContextPanel component (location name, time of day, nearby NPCs)
- [x] Create MiniMap placeholder component (FrameBufferRenderable)
- [x] Create NarrativeBar component (ScrollBoxRenderable for scrollable text)
- [x] Build GameShell orchestrator with multi-panel layout (viewport + side panel + narrative bar)
- [x] Wire OpenTUI Flexbox layout with responsive terminal resize handling
- [x] Integrate existing TileRenderer/ViewportManager into the viewport panel
- [x] Ensure player movement still works within the viewport panel
- [x] Handle minimum 80x24 terminal size gracefully
- [x] Write unit tests for GameShell initialization and mode management
- [x] Visual smoke test: full game chrome renders with panels + walking player

## Progress Log

### 2026-02-12 11:42:20 EST
Initial creation. Extracted from design doc Sections 5.1 (OpenTUI Integration), 6.1 (Game Shell), and Section 16 Step 3.

### 2026-02-12 12:46:27 EST
Starting implementation on branch `main`. Dependency context: tile rendering system is fully operational with FrameBufferRenderable, ViewportManager provides camera tracking and coordinate transforms, player movement/collision detection working. Building on top of this foundation to add multi-panel layout with GameShell orchestrator.

### 2026-02-12 12:57:26 EST
Task completed. Created 4 new files:
- `packages/renderer/src/ui/ContextPanel.ts` — BoxRenderable + TextRenderable wrapper for location/time/NPCs
- `packages/renderer/src/ui/MiniMap.ts` — FrameBufferRenderable placeholder in bordered box
- `packages/renderer/src/ui/NarrativeBar.ts` — ScrollBoxRenderable with sticky-bottom scroll, addLine/clear API
- `apps/game/src/GameShell.ts` — Orchestrator with flexbox layout (topRow: viewport+sidePanel, narrativeBar), mode management, viewport resize handling, min 80x24 check
Updated `packages/renderer/src/index.ts` with new exports. 8 unit tests passing (GameShell.test.ts). Did NOT modify `apps/game/src/index.ts` — two parallel agents (Character Rendering, AI World Gen) are actively modifying it. GameShell is ready for integration when parallel tasks converge.

### 2026-02-12 13:10:38 EST
Branch merged to the main branch.
